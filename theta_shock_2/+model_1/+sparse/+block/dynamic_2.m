function [y, T, residual, g1] = dynamic_2(y, x, params, steady_state, sparse_rowval, sparse_colval, sparse_colptr, T)
residual=NaN(3, 1);
  y(13)=y(14)*(1+params(5))*(1+params(4))-y(3)*(1-params(3));
  T(1)=(y(17)/(y(12)/(y(1)*params(2))-1+params(3)))^(1/(1-y(17)));
  T(2)=exp(y(20));
  T(3)=T(2)^(1-y(17));
  T(4)=(((1-y(17))*(1-y(17)))^(1-y(17)))^(1-params(1));
  T(5)=(params(8)/params(7))^params(1);
  T(6)=(T(3)/exp(y(21))^(1-y(18))*(y(17)/y(18))^y(18)*((1-y(17))*(1-y(18)))^(1-y(18)))^(1-params(1));
  T(7)=(params(9)/params(7))^params(1);
  T(8)=(T(3)/exp(y(22))^(1-y(19))*(y(17)/y(19))^y(19)*((1-y(17))*(1-y(19)))^(1-y(19)))^(1-params(1));
  T(9)=(T(1))^((1-params(1))*(y(17)-y(18)));
  T(10)=(T(1))^((1-params(1))*(y(17)-y(19)));
  T(11)=T(4)+T(6)*T(5)*T(9)+T(8)*T(7)*T(10);
  T(12)=(y(17)*T(4)+T(6)*T(5)*y(18)*T(9)+T(8)*T(7)*y(19)*T(10)-y(17)*T(11))/T(11);
  T(13)=(1-y(17))*(1-y(12)/y(15)*(1-1/T(11)));
  T(14)=y(12)/y(15)*T(12);
  y(16)=T(13)/(1-y(17)-T(14));
  residual(1)=(T(1)*y(16)/y(3))-(y(17)*(1-y(12)/y(15)*(1-1/T(11)))/(y(17)+T(14)));
  T(15)=(y(16)*T(2))^(1-y(17));
  T(16)=(T(1)*y(16)/y(3)*y(14))^y(17);
  residual(2)=(y(12)/T(11))-(T(15)*T(16)-y(13));
  T(17)=(1-y(17))*T(3)*y(14)^y(17);
  T(18)=(T(1)*y(16)/y(3)/y(16))^y(17);
  T(19)=T(17)*T(18);
  residual(3)=(y(15))-(T(19)/(1-y(17)-T(14)));
  T(20)=getPowerDeriv(T(1)*y(16)/y(3)*y(14),y(17),1);
  T(21)=getPowerDeriv(T(1)*y(16)/y(3)/y(16),y(17),1);
  T(22)=getPowerDeriv(y(17)/(y(12)/(y(1)*params(2))-1+params(3)),1/(1-y(17)),1)*(-(y(17)*1/(y(1)*params(2))))/((y(12)/(y(1)*params(2))-1+params(3))*(y(12)/(y(1)*params(2))-1+params(3)));
  T(23)=getPowerDeriv(T(1),(1-params(1))*(y(17)-y(18)),1)*T(22);
  T(24)=getPowerDeriv(T(1),(1-params(1))*(y(17)-y(19)),1)*T(22);
  T(25)=(-((1-1/T(11))*1/y(15)+y(12)/y(15)*(-((-(T(6)*T(5)*T(23)+T(8)*T(7)*T(24)))/(T(11)*T(11))))));
  T(26)=T(12)*1/y(15)+y(12)/y(15)*(T(11)*(T(6)*T(5)*y(18)*T(23)+T(8)*T(7)*y(19)*T(24)-y(17)*(T(6)*T(5)*T(23)+T(8)*T(7)*T(24)))-(y(17)*T(4)+T(6)*T(5)*y(18)*T(9)+T(8)*T(7)*y(19)*T(10)-y(17)*T(11))*(T(6)*T(5)*T(23)+T(8)*T(7)*T(24)))/(T(11)*T(11));
  T(27)=((1-y(17)-T(14))*(1-y(17))*T(25)-T(13)*(-T(26)))/((1-y(17)-T(14))*(1-y(17)-T(14)));
  T(28)=((1-y(17)-T(14))*(1-y(17))*(-((1-1/T(11))*(-y(12))/(y(15)*y(15))))-T(13)*(-(T(12)*(-y(12))/(y(15)*y(15)))))/((1-y(17)-T(14))*(1-y(17)-T(14)));
  T(29)=getPowerDeriv(y(16)*T(2),1-y(17),1);
  T(30)=(y(16)*T(22)+T(1)*T(27))/y(3);
if nargout > 3
    g1_v = NaN(8, 1);
g1_v(1)=T(1)*T(28)/y(3)-((y(17)+T(14))*y(17)*(-((1-1/T(11))*(-y(12))/(y(15)*y(15))))-y(17)*(1-y(12)/y(15)*(1-1/T(11)))*T(12)*(-y(12))/(y(15)*y(15)))/((y(17)+T(14))*(y(17)+T(14)));
g1_v(2)=(-(T(16)*T(29)*T(2)*T(28)+T(15)*T(20)*y(14)*T(1)*T(28)/y(3)));
g1_v(3)=1-((1-y(17)-T(14))*T(17)*T(21)*(y(16)*T(1)*T(28)/y(3)-T(1)*y(16)/y(3)*T(28))/(y(16)*y(16))-T(19)*(-(T(12)*(-y(12))/(y(15)*y(15)))))/((1-y(17)-T(14))*(1-y(17)-T(14)));
g1_v(4)=T(30)-((y(17)+T(14))*y(17)*T(25)-y(17)*(1-y(12)/y(15)*(1-1/T(11)))*T(26))/((y(17)+T(14))*(y(17)+T(14)));
g1_v(5)=(T(11)-y(12)*(T(6)*T(5)*T(23)+T(8)*T(7)*T(24)))/(T(11)*T(11))-(T(16)*T(29)*T(2)*T(27)+T(15)*T(20)*y(14)*T(30));
g1_v(6)=(-(((1-y(17)-T(14))*T(17)*T(21)*(y(16)*T(30)-T(1)*y(16)/y(3)*T(27))/(y(16)*y(16))-T(19)*(-T(26)))/((1-y(17)-T(14))*(1-y(17)-T(14)))));
g1_v(7)=(-(T(15)*T(1)*y(16)/y(3)*T(20)-(1+params(5))*(1+params(4))));
g1_v(8)=(-(T(18)*(1-y(17))*T(3)*getPowerDeriv(y(14),y(17),1)/(1-y(17)-T(14))));
    if ~isoctave && matlab_ver_less_than('9.8')
        sparse_rowval = double(sparse_rowval);
        sparse_colval = double(sparse_colval);
    end
    g1 = sparse(sparse_rowval, sparse_colval, g1_v, 3, 3);
end
end
